# PerceptDataAnalysis
Details of Code involved in the analysis of data from Medtronic Percept PC


# System Requirements
## Hardware requirements
package requires only a standard computer with enough RAM to support the in-memory operations.

## Software requirements
### OS Requirements
This package is supported for Windows 11. The package has been tested on the following systems:
+ Windows 11

### Python Dependencies
```
numpy == 1.24.3
pandas == 2.0.2
openpyxl == 3.1.2
matlabengine == 9.14.3
scikit-learn == 1.2.2
EntropyHub == 0.2
plotly == 5.14.1
kaleido == 0.1.0
```

### MATLAB Dependencies

System requirements:
All MATLAB code run on version 2022b using Windows 11
Windows Requirements: https://www.mathworks.com/content/dam/mathworks/mathworks-dot-com/support/sysreq/files/system-requirements-release-2022b-windows.pdf

Installation guide:
Mathworks MATLAB 2022b: https://www.mathworks.com/downloads
    ~30 minute installation
Respective version of the Signal Processing Toolbox: https://www.mathworks.com/products/signal.html
    ~5 minute installation
EntropyHub Toolbox v0.2: https://github.com/MattWillFlood/EntropyHub
    ~5 minute installation
    

# Code Instructions for Use and Demonstrations
Below are instructions for generating each of the code-based figures in the paper sequentially. For all figures, axis and other aesthetic adjustments were completed on Adobe Illustrator. All Figure code contained in Github folder "figure_scripts". Demo data and figures in DEMO folder.

## Raw Data Extraction
Run data_generation.m in the figure_scripts folder. Select the .json files and indicate both date of DBS onset and patient label when required. Output will be of equivalent form to that stored in demo_data.mat. Estimated runtime 5-10s per patient depending on data quantity.

## Data Preparation

Download “demo_data.mat” to your local data directory. Open dataprep.m from the figure_scripts folder and adjust the load path to “demo_data.mat” in the code. Run code. Expected run time ~4-5 minutes for included demo_data file. Outputs of running are saved in “demo_data_prepped_VCVS.mat” and “demo_data_prepped1day_VCVS.mat” (or equivalent files titled for GPi). All data are saved in the same directory, and this directory will be the same one used for all future code. **FOR THE DEMO, THIS SCRIPT MUST BE RUN ON demo_data.mat PRIOR TO ANY FIGURE SCRIPTS**

## Statistical Calculations
stat_calculations.m in the CircadianPaper folder is the central statistical function. It intakes a percept_data struct (which is the output of the above dataprep.m code), the zone_index variable stored in the above outputted file, and a string field describing the metric you wish to do a statistical comparison for.

## Figure 1
Panel A: generated via Lead-DBS as described in the methods section.

Panel B: download data file "streamsplot.mat" into the data folder accessible by MATLAB. Run figure1.m and edit directories to match those corresponding to your local machine for “streamsplot.mat”, then run the code. 


Demo:

![Fig1](DEMO/Figures/fig1.png)
 


(Runtime ~1-3 seconds)



## Figure 2

Panels A-D are copyrighted artist illustrations.

Panel E-F:

Run figure2.m. Runtime 3-5 seconds.

Demo:

![Fig2heatmap](DEMO/Figures/fig2heatmap.png)
![Fig2acro](DEMO/Figures/fig2acro.png)



## Figure 3

Stills and raw audio trace not shared. Download “audioinfo.mat” into a folder accessible by MATLAB. Adjust the load directory in the code to load the file, and run the program figure3.m. Runtime ~1 second. 

Demo:

![Fig3](DEMO/Figures/fig3audio.png)


## Figure 4
Run figure4.m. The last 3 figures correspond to the dates shown as representatives of the first, second and third quartiles respectively. Demo figure 3 below shows only the example 3rd quartile plots (5th plot generated by code). Expected run time 3-5 seconds.

Demo:

![Fig4wrap](DEMO/Figures/fig4avgwrap.png)
![Fig4unwrap](DEMO/Figures/fig4avgunwrap.png)
![Fig4q3](DEMO/Figures/fig4sd3q.png)




Violin Plots (python code): Allow python access to the data directory and run plot_violin_entropy.py.
![Fig4violin](DEMO/Figures/fig4violin.png)

## Figure 5
Panel A: Run figure5.m. Runtime ~1 second

Demo:

![Fig5](DEMO/Figures/figure5.png)




Panel B: Made entirely through shapes and text in Adobe Illustrator.




## Figure S1
Run figureS1.m Runtime ~1 second.

Demo:


![FigS1heatmap](DEMO/Figures/figs1heatmap.png)
![FigS1acro](DEMO/Figures/figs1acro.png)

## Figure S2
Run figureS2.m Runtime ~1 second.

Demo:

![FigS2a](DEMO/Figures/figureS2a.png)
![FigS2b](DEMO/Figures/figureS2b.png)


## Figure S3
Run figureS3.m Runtime ~1 second.

Demo:

![FigS3](DEMO/Figures/figureS3.png)

## Figure S4
Run figureS4.m Runtime ~1 second. The first two figures are for left GPi, which are shown below. Right GPi data plotted in the second two figures (not shown).

Demo:

![FigS4heatmap](DEMO/Figures/figS4heatmap.png)
![FigS4heatmap](DEMO/Figures/figS4entropy.png)


